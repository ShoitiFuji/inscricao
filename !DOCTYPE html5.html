<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XXIX Fórum Nacional dos Jovens Líderes - REVI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-image: url('https://i.pinimg.com/originals/8c/1c/74/8c1c74c39cb920099011bab3192b72a1.jpg'); 
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            color: #333; 
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 90%;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.93); 
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        /* Landing Page Styles (mantidos) */
        #landing-page h1, #landing-page h2 { color: #0056b3; text-align: center; }
        #landing-page p { text-align: justify; margin-bottom: 1em; }
        #landing-page ul { list-style: disc; margin-left: 20px; }
        .event-details { background-color: rgba(231, 243, 254, 0.9); padding: 15px; border-radius: 5px; margin-bottom: 20px; }
        .event-details strong { color: #004085; }
        .inscricao-btn { display: block; width: 80%; max-width: 300px; margin: 30px auto; padding: 15px 20px; background-color: #28a745; color: white; font-size: 1.2em; text-align: center; text-decoration: none; border-radius: 5px; border: none; cursor: pointer; transition: background-color 0.3s ease; }
        .inscricao-btn:hover { background-color: #218838; }
        .contatos { margin-top: 20px; padding: 10px; background-color: rgba(248, 249, 250, 0.9); border: 1px solid #ddd; border-radius: 5px; }
        .contatos p { text-align: left; }

        /* Form Styles (mantidos) */
        #form-container .form-step { background-color: #fff; }
        .form-step { display: none; padding: 20px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 20px; }
        .form-step.active { display: block; }
        .form-step label { display: block; margin-bottom: 8px; font-weight: bold; color: #0056b3; }
        .form-step input[type="text"], .form-step input[type="email"], .form-step input[type="number"], .form-step select, .form-step textarea { width: calc(100% - 22px); padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .form-step textarea { min-height: 80px; resize: vertical; }
        .form-navigation button { padding: 10px 15px; margin: 5px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .form-navigation button:disabled { background-color: #ccc; }
        .form-navigation button.prev-btn { background-color: #6c757d; }

        /* Specific Inconvenience Styles (anteriores mantidos, novos/alterados abaixo) */
        /* Item 2: Apelido - Novos Estilos */
        #apelido-validation-area { margin-top: 10px; }
        #apelido-validation-message { font-weight: bold; min-height: 20px; padding: 5px; border: 1px dashed transparent; }
        .loading-spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%;
            width: 20px; height: 20px; animation: spin 1s linear infinite;
            display: none; margin: 5px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Item 5: RG - Estilos para Modais de Confirmação */
        .rg-confirm-modal { /* Estilo base para o modal de confirmação de RG */
            display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.6);
            align-items: center; justify-content: center;
        }
        .rg-confirm-modal-content {
            background-color: #fefefe; margin: auto; padding: 25px; border: 1px solid #888;
            width: 80%; max-width: 400px; text-align: center; border-radius: 5px;
            animation: fadeInModal 0.3s;
        }
        .rg-confirm-modal-content button { padding: 10px 18px; margin: 8px; cursor: pointer; }
        @keyframes fadeInModal { from {opacity: 0; transform: scale(0.9);} to {opacity: 1; transform: scale(1);} }

        /* Item 21: Dificuldades - Novos Estilos */
        #dificuldades-eco-box {
            border: 1px dotted #aaa; min-height: 40px; padding: 8px; margin-top: 8px;
            font-family: 'Courier New', Courier, monospace; color: #555;
            background-color: #f9f9f9; font-size: 0.9em;
            word-break: break-all;
        }
        .distorted-char-temp { /* Para o caractere distorcido temporário */
            display: inline-block;
            animation: distortChar 0.1s 1;
        }
        @keyframes distortChar {
            0% { transform: skewX(-10deg) scale(1.1); opacity: 0.5; color: red; }
            50% { transform: skewX(10deg) scale(0.9); opacity: 0.7; color: blue; }
            100% { transform: skewX(0deg) scale(1); opacity: 1; }
        }


        /* Estilos para Modais de Submissão Final */
        .submission-modal {
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.7);
            align-items: center; justify-content: center;
        }
        .submission-modal-content {
            background-color: #fff; margin: auto; padding: 20px; border: 1px solid #888;
            width: 90%; max-width: 500px; text-align: center; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .submission-modal-content h3 { margin-top: 0; color: #0056b3; }
        .submission-modal-content p { margin-bottom: 20px; }
        .submission-modal-content button { padding: 12px 20px; margin: 5px; cursor: pointer; border-radius: 4px; border: none; font-weight: bold; }
        .submission-modal-content button.confirm { background-color: #28a745; color: white; }
        .submission-modal-content button.cancel { background-color: #dc3545; color: white; }
        .submission-modal-content button.neutral { background-color: #6c757d; color: white; }
        #fake-progress-bar-container { width: 80%; margin: 20px auto; background-color: #e0e0e0; border-radius: 5px; }
        #fake-progress-bar { width: 0%; height: 20px; background-color: #4caf50; border-radius: 5px; text-align: center; line-height: 20px; color: white; transition: width 0.5s ease-in-out; }


        /* Mantendo estilos de inconveniências anteriores que não foram alterados */
        #pronome-select { max-height: 150px; overflow-y: scroll; border: 1px solid #ccc; padding: 5px; margin-bottom:10px;}
        #pronome-select div { padding: 2px; cursor: pointer; }
        #gender-canvas-container { margin-bottom: 10px; }
        #gender-canvas { border: 1px solid black; cursor: crosshair; background-color: #fff; }
        #rg-hex-display { font-family: monospace; word-break: break-all; background: #eee; padding: 10px; margin-top: 5px; border: 1px dashed #ccc; min-height: 20px; }
        #dob-calendar { border:1px solid #ccc; padding:10px; margin-bottom:10px; background-color: #fff; }
        #dob-calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom:5px; }
        #dob-calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap:2px; text-align:center;}
        #dob-calendar-days span { padding:5px; background:#eee; cursor: pointer; }
        #age-controls { display: flex; align-items: center; gap: 10px; margin-bottom:10px; }
        #age-display { font-size: 1.5em; font-weight: bold; }
        #email-char-selects { display: flex; flex-wrap: wrap; gap: 2px; margin-bottom:10px; }
        #email-char-selects select { width: auto; padding: 5px; font-size: 0.8em; }
        #telefone-keypad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; max-width: 150px; margin: 10px auto; }
        #telefone-keypad button { padding: 10px; font-size: 1em; }
        #cidade-input { position: relative; }
        #estado-select-container { margin-bottom: 10px; }
        #estado-select { font-size: 6px !important; color: #FAFAFA !important; background-color: #FEFEFE; border: 1px solid #F0F0F0; height: 40px; width: 100%; }
        #estado-select option { font-size: 6px !important; color: #E0E0E0 !important; }
        #seinen-quiz-modal { display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); background:white; padding:20px; border:1px solid #333; box-shadow: 0 0 10px black; z-index:1000; text-align: center;}
        #seinen-quiz-options button { margin: 5px; padding: 8px; }
        #revi-confirm-checkboxes label { display:block; margin-left: 20px; font-weight:normal;}
        #restricao-alimentar-qual.shrinking-text { transition: font-size 0.5s ease-out; }
        #remedio-continuo-qual:focus { outline: 2px solid red; }
        #camiseta-sliders label { font-weight: normal; font-size:0.9em; }
        #camiseta-preview { width: 150px; height: 150px; border:1px solid #ccc; margin:10px auto; background:#f0f0f0; display:flex; justify-content:center; align-items:center; text-align:center; position:relative; overflow:hidden;}
        #camiseta-shape { background: #aaa; transition: all 0.2s ease-in-out; position:absolute;}
        #ano-grupo-slider-value { font-weight: bold; color: #007bff; }
        #cargo-entidade1-word-area { min-height: 50px; border:1px solid #ccc; padding:5px; margin-bottom:10px; }
        #cargo-entidade1-word-area span { display:inline-block; margin-right:5px; padding:2px; animation: fadeOut 3s forwards; cursor:pointer;}
        @keyframes fadeOut { 0% { opacity: 1; } 80% { opacity: 1; } 100% { opacity: 0.1; } }
        #cargo-entidade1-word-area span.fixed { animation: none; opacity:1; background-color: #d4edda;}
        #termos-documento { width: 100%; height: 150px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; font-size: 9px; line-height: 1.2; text-align: justify; background: #f9f9f9; color: #555;}
        #contato-emergencia-nome-keyboard {display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; padding: 10px; border: 1px dashed #ccc; max-width:300px; justify-content:center;}
        #contato-emergencia-nome-keyboard button {width: 30px; height: 30px; }
        .slider-group { display: inline-block; text-align: center; margin: 0 2px;}
        .slider-group input[type="range"] { width: 50px; display:block; margin: 0 auto 2px auto;}
        .slider-group .slider-val { font-size: 0.8em; color: #666; }

    </style>
</head>
<body>

    <div class="container" id="landing-page">
        <img src="https://via.placeholder.com/800x200.png?text=Banner+REVI+2025" alt="Banner REVI 2025" style="width:100%; border-radius: 8px; margin-bottom:20px;">
        <h1>XXIX Fórum Nacional dos Jovens Líderes - REVI 2025: Tecendo Horizontes: Os fios das relações e o sentido de pertencer</h1>
        <hr>
        <p>Bem-vindo(a) ao <strong>XXIX Fórum Nacional dos Jovens Líderes</strong>, o nosso querido <strong>REVI</strong>! Prepare-se para uma imersão transformadora, onde o desenvolvimento pessoal encontra a força da comunidade para moldar o futuro da liderança jovem.</p>
        <p>Este ano, sob o tema <strong>"Tecendo Horizontes: Os fios das relações e o sentido de pertencer"</strong>, vamos explorar as conexões que nos fortalecem e o significado de comunidade em nossas vidas. Serão dias de aprendizado intenso, conexões valiosas e experiências que marcarão sua trajetória.</p>
        <div class="event-details">
            <h2>O que esperar do REVI 2025?</h2>
            <p><strong>🗓️ Data:</strong> 19 a 23 de novembro de 2025</p>
            <p><strong>📍 Local:</strong> Pq. Kokushikan - Um ambiente inspirador para novas ideias e amizades!</p>
            <p><strong>🫂 Organização:</strong> Preparado com carinho pela <a href="#" id="org-link">@comissaodejovensbunkyo</a></p>
        </div>
        <h2>Por que você NÃO PODE PERDER o REVI?</h2>
        <ul>
            <li><strong>Palestras Inspiradoras:</strong> Aprenda com líderes e especialistas que são referência em suas áreas.</li>
            <li><strong>Workshops Dinâmicos:</strong> Desenvolva habilidades práticas em liderança, comunicação, gestão de projetos e muito mais.</li>
            <li><strong>Networking Estratégico:</strong> Conecte-se com jovens líderes de todo o país, expanda sua rede de contatos e crie laços duradouros.</li>
            <li><strong>Cultura e Integração:</strong> Vivencie momentos únicos de intercâmbio cultural e fortaleça o espírito de comunidade.</li>
            <li><strong>Desenvolvimento Pessoal:</strong> Descubra novas ferramentas para o autoconhecimento e impulsione seu crescimento.</li>
        </ul>
        <hr>
        <h2>Inscrições Abertas!</h2>
        <p>Não fique de fora do maior encontro de jovens líderes! Garanta já a sua vaga e prepare-se para uma experiência inesquecível.</p>
        <p><strong>Valor da Inscrição:</strong> R$ 170,00<br>
            <em>(Inclui participação em todas as atividades, material de apoio e certificado)</em>
        </p>
        <button class="inscricao-btn" id="start-form-btn">INSCREVA-SE</button>
        <div class="contatos">
            <h3>Dúvidas? Fale com a gente!</h3>
            <p>A Comissão Organizadora está à disposição para te ajudar:</p>
            <p><strong>Marcus Vinicius:</strong> (11) 98545-7832</p>
            <p><strong>Bruna:</strong> (11) 96528-3186</p>
            <p><strong>Yohanam:</strong> (47) 97745-1428</p>
            <p>Siga-nos nas redes sociais: <a href="#" id="social-link">@comissaodejovensbunkyo</a></p>
        </div>
        <footer style="text-align:center; margin-top:30px; font-size:0.8em; color:#444;">
            <p>© 2025 Comissão de Jovens Bunkyo. Todos os direitos (e algumas dores de cabeça) reservados.</p>
        </footer>
    </div>

    <div class="container" id="form-container">
        <h2>Formulário de Inscrição </h2>
        <div id="form-steps-wrapper">
            <div class="form-step" data-step="1">
                <label for="nome-completo">1. Nome Completo (Digite ao contrário, ele aparecerá na ordem correta):</label>
                <input type="text" id="nome-completo" name="nome-completo">
                <p>Ex: para "Ana Silva", digite "avliS anA"</p>
                <div id="nome-completo-display" style="margin-top:5px; font-weight:bold; color:green;"></div>
            </div>

            <div class="form-step" data-step="2">
                <label for="apelido-input">2. Apelido (Tente a sorte com nosso validador exclusivo!):</label>
                <input type="text" id="apelido-input" name="apelido-tentativa" placeholder="Seu apelido dos sonhos...">
                <div id="apelido-validation-area">
                    <button type="button" id="validar-apelido-btn">Validar Apelido</button>
                    <div class="loading-spinner" id="apelido-loading-spinner"></div>
                    <p id="apelido-validation-message"></p>
                </div>
                <input type="hidden" id="apelido-final" name="apelido"> </div>

            <div class="form-step" data-step="3">
                <label for="pronome-selected-value">3. Pronome (Boa sorte encontrando o seu!):</label>
                <div id="pronome-select"> </div>
                <input type="text" id="pronome-selected-value" name="pronome-final" readonly placeholder="Pronome selecionado aparecerá aqui">
            </div>
            <div class="form-step" data-step="4">
                <label for="gender-canvas">4. Gênero (Desenhe um símbolo que o represente):</label>
                <div id="gender-canvas-container"> <canvas id="gender-canvas" width="300" height="150"></canvas> </div>
                <button type="button" id="clear-gender-canvas">Limpar Desenho</button>
                <input type="hidden" id="gender-drawing-data" name="gender-drawing">
            </div>

            <div class="form-step" data-step="5">
                <label for="rg-input-normal">5. RG (Confirmação dígito a dígito... lentamente!):</label>
                <input type="text" id="rg-input-normal" name="rg-normal" placeholder="Digite seu RG completo (ex: 12345678X)">
                <button type="button" id="iniciar-confirmacao-rg-btn" style="margin-top:5px;">Confirmar RG Digitado</button>
                <p id="rg-confirm-status" style="font-size:0.9em; color: #666;"></p>
                <input type="hidden" id="rg-confirmado-final" name="rg-confirmado">
            </div>

            <div class="form-step" data-step="6">
                <label>6. Data de Nascimento (Só um mês por vez para trás, começando hoje):</label>
                <div id="dob-calendar">
                    <div id="dob-calendar-header">
                        <button type="button" id="dob-prev-month">< Mês Anterior</button>
                        <span id="dob-current-month-year">Maio 2025</span>
                        <button type="button" id="dob-next-month" disabled>Mês Seguinte ></button>
                    </div>
                    <div id="dob-calendar-days"> </div>
                </div>
                <input type="text" id="data-nascimento-input" name="data-nascimento" readonly placeholder="DD/MM/AAAA">
            </div>
            <div class="form-step" data-step="7">
                <label>7. Idade (Clique "+1" até sua idade. Errou? Reset para 0!):</label>
                <div id="age-controls">
                    <button type="button" id="age-increment-btn">+1</button>
                    <span id="age-display">0</span>
                    <button type="button" id="age-reset-btn">Resetar para 0</button>
                </div>
                <input type="hidden" id="idade-input" name="idade">
            </div>
            <div class="form-step" data-step="8">
                <label>8. E-mail (Um seletor para cada caractere. Paciência!):</label>
                <div id="email-char-selects"> </div>
                <input type="text" id="email-preview" name="email-preview" readonly placeholder="Prévia do e-mail">
                <button type="button" id="add-email-char-select">Adicionar Caractere</button>
                <button type="button" id="remove-email-char-select">Remover Último</button>
            </div>
            <div class="form-step" data-step="9">
                <label for="telefone-input">9. Telefone de Contato (Teclado numérico embaralhado a cada clique):</label>
                <input type="text" id="telefone-input" name="telefone" readonly>
                <div id="telefone-keypad"> </div>
            </div>

            <div class="form-step" data-step="10">
                <label for="cidade-input">10. Cidade (Cursor saltitante!):</label>
                <input type="text" id="cidade-input" name="cidade">
                
                <label for="estado-select" style="margin-top:15px;">Estado (Encontre se puder!):</label>
                <div id="estado-select-container">
                     <select id="estado-select" name="estado">
                        </select>
                </div>
            </div>

            <div class="form-step" data-step="11">
                <label for="seinen-entidade">11. Qual seinen/Entidade representa? (Quiz a cada 3 caracteres!):</label>
                <input type="text" id="seinen-entidade" name="seinen-entidade">
                <div id="seinen-quiz-modal">
                    <h4 id="seinen-quiz-question">Pergunta do Quiz:</h4>
                    <div id="seinen-quiz-options"></div>
                    <p id="seinen-quiz-feedback"></p>
                </div>
            </div>
            
            <div class="form-step" data-step="12">
                <label>12. Já participou de alguma edição da REVI?</label>
                <div> <input type="radio" id="revi-nao" name="revi-participou" value="nao" checked> <label for="revi-nao" style="font-weight:normal;">Não</label> </div>
                <div> <input type="radio" id="revi-sim-main" name="revi-participou" value="sim"> <label for="revi-sim-main" style="font-weight:normal;">Sim</label> </div>
                <div id="revi-confirm-checkboxes" style="display:none; margin-left:20px;">
                    <input type="checkbox" id="revi-confirm1" name="revi-confirm1" value="certeza"> <label for="revi-confirm1">Tem certeza?</label>
                    <input type="checkbox" id="revi-confirm2" name="revi-confirm2" value="absoluta" disabled> <label for="revi-confirm2">Certeza absoluta mesmo?</label>
                    <input type="checkbox" id="revi-confirm3" name="revi-confirm3" value="dedinho" disabled> <label for="revi-confirm3">Promete de dedinho?</label>
                </div>
            </div>

            <div class="form-step" data-step="13">
                <label>13. Possui alguma restrição alimentar?</label>
                <select id="restricao-alimentar-select" name="restricao-alimentar-opcao">
                    <option value="nao">Não</option>
                    <option value="sim">Sim</option>
                </select>
                <div id="restricao-alimentar-detalhes" style="display:none;">
                    <label for="restricao-alimentar-qual">Se sim, qual? (Máx. 30 chars, fonte diminui):</label>
                    <input type="text" id="restricao-alimentar-qual" name="restricao-alimentar-qual" maxlength="30">
                </div>
            </div>

            <div class="form-step" data-step="14">
                <label>14. Possui alguma alergia?</label>
                <select id="alergia-select" name="alergia-opcao"> <option value="nao">Não</option> <option value="sim">Sim</option> </select>
                <div id="alergia-detalhes" style="display:none;">
                    <label for="alergia-qual">Se sim, qual? (Seu segredo estará seguro conosco *pisca*):</label>
                    <input type="text" id="alergia-qual" name="alergia-qual-display" placeholder="Digite aqui, mas não vai dar pra ler">
                </div>
            </div>
            <div class="form-step" data-step="15">
                <label>15. Toma remédio de uso contínuo?</label>
                <select id="remedio-continuo-select" name="remedio-continuo-opcao"> <option value="nao">Não</option> <option value="sim">Sim</option> </select>
                <div id="remedio-continuo-detalhes" style="display:none;">
                    <label for="remedio-continuo-qual">Se sim, qual? (Mantenha o mouse em movimento DENTRO do campo para digitar!):</label>
                    <input type="text" id="remedio-continuo-qual" name="remedio-continuo-qual">
                    <p id="remedio-mouse-status" style="font-size:0.8em; color:red;"></p>
                </div>
            </div>
            <div class="form-step" data-step="16">
                <label>16. Tamanho da Camiseta (Ajuste o manequim até ficar "aceitável"):</label>
                <div id="camiseta-preview"> <div id="camiseta-shape">Camiseta</div> </div>
                <div id="camiseta-sliders">
                    <div><label for="slider-ombros">Ombros:</label> Pouco <input type="range" id="slider-ombros" min="20" max="100" value="50"> Muito</div>
                    <div><label for="slider-peito">Peito/Largura:</label> Pouco <input type="range" id="slider-peito" min="20" max="100" value="50"> Muito</div>
                    <div><label for="slider-comprimento">Comprimento:</label> Pouco <input type="range" id="slider-comprimento" min="30" max="100" value="60"> Muito</div>
                    <div><label for="slider-mangas">Mangas:</label> Pouco <input type="range" id="slider-mangas" min="10" max="80" value="30"> Muito</div>
                    <div><label for="slider-gola">Gola:</label> Pouco <input type="range" id="slider-gola" min="10" max="50" value="20"> Muito</div>
                </div>
                <input type="hidden" name="camiseta-config" id="camiseta-config-input">
            </div>
            <div class="form-step" data-step="17">
                <label for="ano-grupo-slider">17. Em qual ano começou a participar do grupo? (Slider sensível, de 1950 a 2025):</label>
                <input type="range" id="ano-grupo-slider" name="ano-grupo-slider" min="1950" max="2025" value="2000" style="width:100%;">
                <p>Ano selecionado: <span id="ano-grupo-slider-value" style="font-size:0.7em; color:#666;">2000</span></p>
            </div>
            <div class="form-step" data-step="18">
                <label for="cargo-entidade1">18. Qual é, ou qual foi, seu cargo dentro da entidade? (Palavras somem se não fixadas!):</label>
                <input type="text" id="cargo-entidade1-input" placeholder="Digite palavra por palavra aqui...">
                <button type="button" id="cargo-entidade1-add-word">Adicionar Palavra</button>
                <div id="cargo-entidade1-word-area"> </div>
                <input type="hidden" id="cargo-entidade1-final" name="cargo-entidade1">
            </div>
            
            <div class="form-step" data-step="19">
                <label>19. Declara que leu as informações acima, e concorda com os termos?</label>
                <div id="termos-documento"> Artigo I - Das Partes... Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed non risus. Suspendisse lectus tortor, dignissim sit amet, adipiscing nec, ultricies sed, dolor. Cras elementum ultrices diam. Maecenas ligula massa, varius a, semper congue, euismod non, mi. ... (MUITO TEXTO AQUI, incluindo "RESPONSABILIDADE" várias vezes no Artigo IV, Seção 3) ... Artigo IV ... Seção 3 ... A primeira RESPONSABILIDADE é... Outra RESPONSABILIDADE importante... E também a RESPONSABILIDADE final... não se esqueça da RESPONSABILIDADE principal... e a RESPONSABILIDADE acessória... nem da penúltima RESPONSABILIDADE... e muito menos da RESPONSABILIDADE derradeira. ... (MAIS TEXTO) ... FIM DOS TERMOS. </div>
                <label for="termos-palavra-count">Para validar sua leitura atenta, por favor, conte e insira abaixo quantas vezes a palavra 'RESPONSABILIDADE' (exatamente assim, em maiúsculas) aparece no Artigo IV, Seção 3 dos Termos e Condições acima.</label>
                <input type="number" id="termos-palavra-count" name="termos-palavra-count" min="0">
                <p id="termos-feedback" style="color:red; font-size:0.9em;"></p>
                <div> <input type="checkbox" id="termos-concordo" name="termos-concordo" value="concordo" disabled> <label for="termos-concordo" style="font-weight:normal;">Declaro que li e concordo com os termos (e contei corretamente).</label> </div>
            </div>

            <div class="form-step" data-step="20">
                <label for="contato-emergencia-nome">20. Contato de Emergência - Nome (Use o teclado virtual maluco):</label>
                <input type="text" id="contato-emergencia-nome" name="contato-emergencia-nome" readonly>
                <div id="contato-emergencia-nome-keyboard"> </div>
                <button type="button" id="contato-emergencia-nome-backspace">Apagar (Nome)</button>
                <label for="contato-emergencia-telefone-slider0" style="margin-top:15px;">Contato de Emergência - Telefone (11 sliders sensíveis):</label>
                <div id="contato-emergencia-telefone-sliders">
                    ( <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider0" min="0" max="9" value="0"><span class="slider-val">0</span></span>
                    <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider1" min="0" max="9" value="0"><span class="slider-val">0</span></span> ) 
                    <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider2" min="0" max="9" value="0"><span class="slider-val">0</span></span>
                    <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider3" min="0" max="9" value="0"><span class="slider-val">0</span></span>
                    <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider4" min="0" max="9" value="0"><span class="slider-val">0</span></span>
                    <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider5" min="0" max="9" value="0"><span class="slider-val">0</span></span>
                    <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider6" min="0" max="9" value="0"><span class="slider-val">0</span></span>
                    -
                    <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider7" min="0" max="9" value="0"><span class="slider-val">0</span></span>
                    <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider8" min="0" max="9" value="0"><span class="slider-val">0</span></span>
                    <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider9" min="0" max="9" value="0"><span class="slider-val">0</span></span>
                    <span class="slider-group"><input type="range" id="contato-emergencia-telefone-slider10" min="0" max="9" value="0"><span class="slider-val">0</span></span>
                </div>
                <input type="text" id="contato-emergencia-telefone-preview" name="contato-emergencia-telefone" readonly style="margin-top:5px;">
            </div>

            <div class="form-step" data-step="21">
                <label for="dificuldades-seinekai-input">21. Dificuldades enfrentadas no seu seinekai (Desabafo com eco lento e distorcido):</label>
                <textarea id="dificuldades-seinekai-input" rows="3" placeholder="Digite suas dificuldades aqui... o texto real aparecerá abaixo com um certo... charme."></textarea>
                <label style="font-weight:normal; font-size:0.9em; margin-top:5px;">Eco do seu desabafo (aparece com atraso):</label>
                <div id="dificuldades-eco-box" aria-live="polite"></div>
                <input type="hidden" id="dificuldades-seinekai-final" name="dificuldades-seinekai">
                <button type="button" id="finalizar-desabafo-btn" style="margin-top:5px;">Finalizar Desabafo (Transferir Texto)</button>
            </div>


            <div class="form-navigation">
                <button type="button" id="prev-btn" class="prev-btn" disabled>Anterior (Sem chance!)</button>
                <button type="button" id="next-btn">Próximo</button>
                <button type="button" id="submit-form-btn" style="display:none; background-color: #28a745;">Enviar Inscrição (Se conseguir!)</button>
            </div>
        </div>
    </div>

    <div id="submission-modal-confirm" class="submission-modal" style="display: flex;"> <div class="submission-modal-content">
            <h3>Confirmação Final</h3>
            <p>Tem certeza que deseja enviar esta tortura... digo, inscrição? Não haverá como voltar atrás (provavelmente).</p>
            <button type="button" id="submit-yes-btn" class="confirm">Sim, enviar!</button>
            <button type="button" id="submit-no-btn" class="cancel">Não, me tire daqui!</button>
        </div>
    </div>

    <div id="submission-modal-loading" class="submission-modal" style="display: flex;">
        <div class="submission-modal-content">
            <h3>Processando...</h3>
            <div class="loading-spinner" style="display: block; border-top-color: #007bff; width:40px; height:40px; margin-bottom:15px;"></div>
            <div id="fake-progress-bar-container">
                <div id="fake-progress-bar">0%</div>
            </div>
            <p id="fake-loading-message" style="font-size:0.9em; color:#555; min-height:20px;">Iniciando envio...</p>
        </div>
    </div>

    <div id="submission-modal-final" class="submission-modal" style="display: flex;">
        <div class="submission-modal-content">
            <h3 id="final-submission-title"></h3>
            <p id="final-submission-message"></p>
            <button type="button" id="final-ok-btn" class="neutral">Ok, fazer o quê...</button>
        </div>
    </div>

    <div id="rg-digit-confirm-modal" class="rg-confirm-modal">
        <div class="rg-confirm-modal-content">
            <p id="rg-digit-confirm-text"></p>
            <button type="button" id="rg-confirm-yes">Sim</button>
            <button type="button" id="rg-confirm-no">Não</button>
        </div>
    </div>


    <script>
        // Garantir que todos os elementos do DOM sejam encontrados
        const landingPage = document.getElementById('landing-page');
        const formContainer = document.getElementById('form-container');
        const startFormBtn = document.getElementById('start-form-btn');
        const formSteps = Array.from(document.querySelectorAll('.form-step'));
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const submitFormBtn = document.getElementById('submit-form-btn');
        
        let currentStep = 0;
        const formData = {}; 

        // Elementos dos Modais de Submissão
        const modalConfirm = document.getElementById('submission-modal-confirm');
        const modalLoading = document.getElementById('submission-modal-loading');
        const modalFinal = document.getElementById('submission-modal-final');
        const submitYesBtn = document.getElementById('submit-yes-btn');
        const submitNoBtn = document.getElementById('submit-no-btn');
        const fakeProgressBar = document.getElementById('fake-progress-bar');
        const fakeLoadingMessage = document.getElementById('fake-loading-message');
        const finalSubmissionTitle = document.getElementById('final-submission-title');
        const finalSubmissionMessage = document.getElementById('final-submission-message');
        const finalOkBtn = document.getElementById('final-ok-btn');

        // Mapa para funções de reset específicas por passo
        const stepResetters = {
            1: () => { 
                const el = document.getElementById('nome-completo-display'); if (el) el.textContent = ''; 
                const inputEl = document.getElementById('nome-completo'); if(inputEl) inputEl.value = '';
            },
            2: () => { // Reset para Apelido (NOVO)
                const inputEl = document.getElementById('apelido-input'); if(inputEl) inputEl.value = '';
                const msgEl = document.getElementById('apelido-validation-message'); if(msgEl) {msgEl.textContent = ''; msgEl.style.borderColor = 'transparent';}
                const finalEl = document.getElementById('apelido-final'); if(finalEl) finalEl.value = '';
                apelidoAceito = false; // Resetar estado de aceitação
            },
            3: () => {
                const el = document.getElementById('pronome-selected-value'); if (el) el.value = '';
            },
            4: () => { 
                if (ctxGender) ctxGender.clearRect(0, 0, genderCanvas.width, genderCanvas.height);
                const el = document.getElementById('gender-drawing-data'); if (el) el.value = "";
            },
            5: () => { // Reset para RG (NOVO)
                const rgNorm = document.getElementById('rg-input-normal'); if (rgNorm) {rgNorm.value = ''; rgNorm.disabled = false;}
                const rgConfBtn = document.getElementById('iniciar-confirmacao-rg-btn'); if(rgConfBtn) rgConfBtn.disabled = false;
                const rgConfStat = document.getElementById('rg-confirm-status'); if(rgConfStat) rgConfStat.textContent = '';
                const rgFin = document.getElementById('rg-confirmado-final'); if(rgFin) rgFin.value = '';
                rgConfirmCurrentDigitIndex = 0;
                rgDigitsToConfirm = [];
            },
            6: () => {
                const el = document.getElementById('data-nascimento-input'); if (el) el.value = '';
                // O initializer do passo 6 já reseta o dobCurrentDate e renderiza o calendário.
            },
            7: () => { 
                currentAgeVal = 0; 
                const disp = document.getElementById('age-display'); if(disp) disp.textContent = '0'; 
                const hid = document.getElementById('idade-input'); if(hid) hid.value = '0'; 
            },
            8: () => {
                const el = document.getElementById('email-preview'); if (el) el.value = '';
                emailSelectCount = 5; 
                if(typeof renderEmailSelects === "function") renderEmailSelects();
            },
            9: () => {
                const el = document.getElementById('telefone-input'); if (el) el.value = '';
                if(typeof renderTelefoneKeypad === "function") renderTelefoneKeypad();
            },
            10: () => {
                 const cid = document.getElementById('cidade-input'); if (cid) cid.value = '';
                 const est = document.getElementById('estado-select'); if (est) est.selectedIndex = 0; 
            },
            11: () => { 
                const el = document.getElementById('seinen-entidade'); if(el) el.value = '';
                seinenCharsTyped = 0;
                seinenPreviousLength = 0;
                seinenValueBeforeQuiz = "";
                const modal = document.getElementById('seinen-quiz-modal'); if(modal) modal.style.display = 'none';
            },
            12: () => { 
                const nao = document.getElementById('revi-nao'); if(nao) nao.checked = true;
                const sim = document.getElementById('revi-sim-main'); if(sim) sim.checked = false;
                const div = document.getElementById('revi-confirm-checkboxes'); if(div) div.style.display = 'none';
                const c1 = document.getElementById('revi-confirm1'); if(c1) c1.checked = false;
                const c2 = document.getElementById('revi-confirm2'); if(c2) {c2.checked = false; c2.disabled = true;}
                const c3 = document.getElementById('revi-confirm3'); if(c3) {c3.checked = false; c3.disabled = true;}
            },
            13: () => {
                const sel = document.getElementById('restricao-alimentar-select'); if(sel) sel.value = 'nao';
                const det = document.getElementById('restricao-alimentar-detalhes'); if(det) det.style.display = 'none';
                const qual = document.getElementById('restricao-alimentar-qual'); 
                if(qual) { qual.value = ''; qual.style.fontSize = '16px'; }
            },
            14: () => {
                const sel = document.getElementById('alergia-select'); if(sel) sel.value = 'nao';
                const det = document.getElementById('alergia-detalhes'); if(det) det.style.display = 'none';
                const qualD = document.getElementById('alergia-qual'); if(qualD) qualD.value = '';
                alergiaRealValue = '';
            },
            15: () => {
                const sel = document.getElementById('remedio-continuo-select'); if(sel) sel.value = 'nao';
                const det = document.getElementById('remedio-continuo-detalhes'); if(det) det.style.display = 'none';
                const qual = document.getElementById('remedio-continuo-qual'); if(qual) qual.value = '';
                const stat = document.getElementById('remedio-mouse-status'); if(stat) stat.textContent = "";
            },
            16: () => { 
                const sliders = document.querySelectorAll('#camiseta-sliders input[type="range"]');
                sliders.forEach(s => {
                    if(s.id === 'slider-comprimento') s.value = 60;
                    else if (s.id === 'slider-mangas') s.value = 30;
                    else if (s.id === 'slider-gola') s.value = 20;
                    else s.value = 50;
                });
                if(typeof updateCamisetaPreview === "function") updateCamisetaPreview();
            },
            17: () => {
                const s = document.getElementById('ano-grupo-slider'); if(s) s.value = 2000;
                const disp = document.getElementById('ano-grupo-slider-value'); if(disp) disp.textContent = '2000';
            },
            18: () => {
                const area = document.getElementById('cargo-entidade1-word-area'); if(area) area.innerHTML = '';
                const inp = document.getElementById('cargo-entidade1-input'); if(inp) inp.value = '';
                const fin = document.getElementById('cargo-entidade1-final'); if(fin) fin.value = '';
            },
            19: () => {
                const countInp = document.getElementById('termos-palavra-count'); if(countInp) countInp.value = '';
                const check = document.getElementById('termos-concordo'); if(check) { check.checked = false; check.disabled = true; }
                const feed = document.getElementById('termos-feedback'); if(feed) feed.textContent = '';
            },
            20: () => {
                const nome = document.getElementById('contato-emergencia-nome'); if(nome) nome.value = '';
                const ceTelSlidersNodeList = document.querySelectorAll('#contato-emergencia-telefone-sliders input[type="range"]');
                ceTelSlidersNodeList.forEach(s => s.value = 0);
                if(typeof updateCeTelefonePreview === "function") updateCeTelefonePreview();
            },
            21: () => { // Reset para Dificuldades (NOVO)
                const inp = document.getElementById('dificuldades-seinekai-input'); if(inp) inp.value = '';
                const eco = document.getElementById('dificuldades-eco-box'); if(eco) eco.innerHTML = '';
                const fin = document.getElementById('dificuldades-seinekai-final'); if(fin) fin.value = '';
                dificuldadesBuffer = "";
                if (dificuldadesTimeoutId) clearTimeout(dificuldadesTimeoutId);
            }
        };


        function showStep(stepIndex) {
            if (!formSteps[stepIndex]) {
                console.error("Passo do formulário não encontrado:", stepIndex);
                return;
            }
            formSteps.forEach((step, index) => {
                step.classList.toggle('active', index === stepIndex);
            });
            if(prevBtn) prevBtn.disabled = stepIndex === 0; 
            if(nextBtn) nextBtn.style.display = stepIndex === formSteps.length - 1 ? 'none' : 'inline-block';
            if(submitFormBtn) submitFormBtn.style.display = stepIndex === formSteps.length - 1 ? 'inline-block' : 'none';

            const currentStepElement = formSteps[stepIndex];
            const stepNumber = parseInt(currentStepElement.dataset.step);
            if (stepInitializers[stepNumber]) {
                stepInitializers[stepNumber]();
            }
        }

        function saveStepData(stepIndex) {
            // ... (função saveStepData mantida como na versão anterior, adaptada para os novos campos se necessário)
            if (!formSteps[stepIndex]) return;
            const currentStepElement = formSteps[stepIndex];
            const inputs = currentStepElement.querySelectorAll('input[type="text"]:not([readonly]), input[type="number"], input[type="hidden"], input[type="email"], select, textarea');
            
            inputs.forEach(input => {
                if (input.name) {
                    formData[input.name] = input.value;
                }
            });

            const checkRadios = currentStepElement.querySelectorAll('input[type="checkbox"], input[type="radio"]');
            checkRadios.forEach(cr => {
                if (cr.name) {
                    if (cr.type === 'checkbox') {
                        if (cr.value && cr.name !== 'termos-concordo' && !cr.name.startsWith('revi-confirm')) { 
                             if (!formData[cr.name]) formData[cr.name] = [];
                             const valueIndex = formData[cr.name].indexOf(cr.value);
                             if (cr.checked) {
                                 if (valueIndex === -1) formData[cr.name].push(cr.value);
                             } else {
                                 if (valueIndex !== -1) formData[cr.name].splice(valueIndex, 1);
                             }
                        } else { 
                            formData[cr.name] = cr.checked;
                        }
                    } else if (cr.type === 'radio') {
                        if (cr.checked) {
                            formData[cr.name] = cr.value;
                        }
                    }
                }
            });

            const stepNumber = parseInt(currentStepElement.dataset.step);
            if (stepSavers[stepNumber]) {
                stepSavers[stepNumber](); 
            }
            console.log(`Dados salvos (Passo ${stepNumber}):`, JSON.parse(JSON.stringify(formData)));
        }


        if(startFormBtn){
            startFormBtn.addEventListener('click', () => {
                if (!landingPage || !formContainer) {
                    console.error("Elementos landingPage ou formContainer não encontrados.");
                    return;
                }
                landingPage.style.display = 'none';
                formContainer.style.display = 'block';

                for (const key in formData) { delete formData[key]; } 
                currentStep = 0;
                
                formSteps.forEach((step) => {
                    const stepNumber = parseInt(step.dataset.step);
                    if (stepResetters && stepResetters[stepNumber]) {
                        stepResetters[stepNumber]();
                    } else { 
                        step.querySelectorAll('input[type="text"]:not([readonly]), input[type="number"], input[type="hidden"], input[type="email"], textarea').forEach(input => input.value = '');
                        step.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => input.checked = false);
                        step.querySelectorAll('select').forEach(select => select.selectedIndex = 0);
                    }
                });
                showStep(currentStep);
            });
        }
        
        if(prevBtn) {
            prevBtn.title = "Voltar? Sem chance!"; 
            prevBtn.addEventListener('click', () => { 
                if (currentStep > 0) {
                    currentStep--;
                    showStep(currentStep);
                }
            });
        }

        if(nextBtn) {
            nextBtn.addEventListener('click', () => {
                saveStepData(currentStep); 
                if (currentStep < formSteps.length - 1) {
                    currentStep++;
                    showStep(currentStep);
                }
            });
        }

        // Lógica dos Modais de Submissão
        function showSubmissionModal(modalElement) {
            if(modalConfirm) modalConfirm.style.display = 'none';
            if(modalLoading) modalLoading.style.display = 'none';
            if(modalFinal) modalFinal.style.display = 'none';
            if(modalElement) modalElement.style.display = 'flex'; // Usar flex para centralizar
        }

        if(submitFormBtn){
            submitFormBtn.addEventListener('click', () => {
                saveStepData(currentStep); 
                showSubmissionModal(modalConfirm);
            });
        }

        if(submitYesBtn) {
            submitYesBtn.addEventListener('click', () => {
                showSubmissionModal(modalLoading);
                let progress = 0;
                const messages = ["Processando sua paciência...", "Verificando se você realmente leu os termos...", "Consultando os astros sobre seu apelido...", "Compactando frustrações...", "Enviando dados para o abismo digital..."];
                let messageIndex = 0;
                if(fakeLoadingMessage) fakeLoadingMessage.textContent = messages[messageIndex];

                const interval = setInterval(() => {
                    progress += Math.floor(Math.random() * 15) + 10; // Incremento aleatório
                    if (progress >= 100) {
                        progress = 100;
                        clearInterval(interval);
                        if(fakeLoadingMessage) fakeLoadingMessage.textContent = "Quase lá!";
                        setTimeout(() => {
                            if(finalSubmissionTitle) finalSubmissionTitle.textContent = "Inscrição Enviada!";
                            if(finalSubmissionMessage) finalSubmissionMessage.textContent = `Sua inscrição para o REVI foi enviada com (quase) sucesso! Um e-mail de confirmação (que talvez nunca chegue, ou vá para o spam, ou esteja em Klingon) foi "enviado" para ${formData['email-final'] || 'seuemail@naosei.com'}. Obrigado pela sua... persistência. Se não receber em 72 horas, tente se inscrever novamente desde o início (apenas para garantir).`;
                            showSubmissionModal(modalFinal);
                        }, 1000);
                    }
                    if(fakeProgressBar) fakeProgressBar.style.width = progress + '%';
                    if(fakeProgressBar) fakeProgressBar.textContent = progress + '%';
                    if (progress > (messageIndex + 1) * (100 / messages.length) && messageIndex < messages.length -1 ) {
                         messageIndex++;
                         if(fakeLoadingMessage) fakeLoadingMessage.textContent = messages[messageIndex];
                    }
                }, 800);
            });
        }

        if(submitNoBtn) {
            submitNoBtn.addEventListener('click', () => {
                if(finalSubmissionTitle) finalSubmissionTitle.textContent = "Desistência Registrada!";
                if(finalSubmissionMessage) finalSubmissionMessage.textContent = "Covarde! Mas entendemos. Seus dados foram carinhosamente descartados (para o lixo cósmico). Deseja tentar novamente esta aventura ou fugir para as montanhas?";
                if(finalOkBtn) {
                     finalOkBtn.textContent = "Fugir para as Montanhas (Sensato)";
                     finalOkBtn.onclick = () => { window.location.reload(); }; // Recarrega, voltando para landing
                }
                // Poderia adicionar um botão "Tentar Novamente" aqui
                showSubmissionModal(modalFinal);
            });
        }
        
        if(finalOkBtn) {
             finalOkBtn.onclick = () => {
                window.location.reload(); // Ação padrão é recarregar
            };
        }


        const stepInitializers = {};
        const stepSavers = {};

        // --- Lógica específica para cada inconveniência ---

        // Passo 1: Nome Completo
        const nomeCompletoInput = document.getElementById('nome-completo');
        const nomeCompletoDisplay = document.getElementById('nome-completo-display');
        if (nomeCompletoInput) {
            nomeCompletoInput.addEventListener('input', () => {
                const typedValue = nomeCompletoInput.value;
                const reversedValue = typedValue.split('').reverse().join('');
                if(nomeCompletoDisplay) nomeCompletoDisplay.textContent = reversedValue;
            });
        }
        stepSavers[1] = () => { 
            if(nomeCompletoInput) formData['nome-completo-digitado'] = nomeCompletoInput.value; 
            if(nomeCompletoDisplay) formData['nome-completo-corrigido'] = nomeCompletoDisplay.textContent; 
        }

        // Passo 2: Apelido (NOVA INCONVENIÊNCIA)
        const apelidoInputEl = document.getElementById('apelido-input'); // Renomeado para evitar conflito com 'apelido-final'
        const validarApelidoBtn = document.getElementById('validar-apelido-btn');
        const apelidoLoadingSpinner = document.getElementById('apelido-loading-spinner');
        const apelidoValidationMessageEl = document.getElementById('apelido-validation-message');
        const apelidoFinalInput = document.getElementById('apelido-final');
        let apelidoAceito = false;

        const mensagensValidacaoApelido = [
            { msg: "Este apelido já está em uso por um personagem de desenho animado dos anos 80. Tente outro.", cor: "red" },
            { msg: "Apelido muito curto. Precisa de mais substância!", cor: "orange" },
            { msg: "Apelido muito longo. Menos é mais, às vezes.", cor: "orange" },
            { msg: "Nível de criatividade: Baixo. Nosso sistema exige mais!", cor: "red" },
            { msg: "Nosso sistema de IA detectou que este apelido não combina com sua aura astral. Escolha novamente.", cor: "purple" },
            { msg: "Apelido contém caracteres não permitidos em Nárnia (e aqui também).", cor: "red" },
            { msg: "Para usar este apelido, decifre: O que tem cidades, mas não casas; florestas, mas não árvores; e água, mas não peixes?", cor: "blue" }, // Resposta: Mapa
            { msg: "Apelido aceito... por enquanto. Estamos de olho!", cor: "green", aceito: true }
        ];

        if(validarApelidoBtn && apelidoInputEl && apelidoLoadingSpinner && apelidoValidationMessageEl && apelidoFinalInput){
            validarApelidoBtn.addEventListener('click', () => {
                apelidoLoadingSpinner.style.display = 'block';
                apelidoValidationMessageEl.textContent = '';
                apelidoValidationMessageEl.style.borderColor = 'transparent';
                validarApelidoBtn.disabled = true;
                apelidoInputEl.disabled = true;

                setTimeout(() => {
                    apelidoLoadingSpinner.style.display = 'none';
                    const randomIndex = Math.floor(Math.random() * mensagensValidacaoApelido.length);
                    const validacao = mensagensValidacaoApelido[randomIndex];
                    
                    apelidoValidationMessageEl.textContent = validacao.msg;
                    apelidoValidationMessageEl.style.color = validacao.cor;
                    apelidoValidationMessageEl.style.borderColor = validacao.cor;

                    if (validacao.aceito) {
                        apelidoAceito = true;
                        apelidoFinalInput.value = apelidoInputEl.value;
                        // Poderia desabilitar o botão de validar permanentemente após aceito
                    } else {
                        apelidoAceito = false;
                        apelidoFinalInput.value = ""; // Limpa se não aceito
                         validarApelidoBtn.disabled = false; // Permite tentar de novo
                         apelidoInputEl.disabled = false;
                    }
                }, Math.random() * 2000 + 3000); // Delay de 3-5 segundos
            });
        }
        stepInitializers[2] = () => {
            if(apelidoInputEl) apelidoInputEl.value = formData['apelido-tentativa'] || '';
            if(apelidoValidationMessageEl) {
                apelidoValidationMessageEl.textContent = '';
                apelidoValidationMessageEl.style.borderColor = 'transparent';
            }
            if(apelidoLoadingSpinner) apelidoLoadingSpinner.style.display = 'none';
            if(validarApelidoBtn) validarApelidoBtn.disabled = false;
            if(apelidoInputEl) apelidoInputEl.disabled = false;
            apelidoAceito = formData['apelido'] ? true : false; // Se já tem apelido final, considera aceito
            if(apelidoFinalInput) apelidoFinalInput.value = formData['apelido'] || '';

        };
        stepSavers[2] = () => {
            // O formData['apelido'] será o apelido final se aceito.
            // formData['apelido-tentativa'] já é salvo pelo genérico.
            // Não precisa fazer nada extra aqui se apelidoFinalInput é o que conta.
        }
        
        // Passo 3: Pronome (Lógica mantida)
        const pronomeSelectDiv = document.getElementById('pronome-select');
        const pronomeSelectedValueInput = document.getElementById('pronome-selected-value');
        const pronomes = [ "Ela/Dela", "Ele/Dele", "Elu/Delu", "Ze/Zir", "Xe/Xer", "Voi/Void", "Fae/Faer", "Sol/Solis", "Lunae/Luna", "Ignis/Igni", "គាត់/របស់គាត់", "Он/Его", "彼女/彼女の", "هو/له", "A Estrela Cadente/Da Estrela Cadente", "O Rio que Flui/Do Rio que Flui", "A Montanha Silenciosa/Da Montanha Silenciosa", "?", "!", "@", "#", "$", "%", "^", "&", "*", "(", ")", "_", "+", "=", "-", "O Programador/Do Programador", "A Lógica/Da Lógica", "O Algoritmo/Do Algoritmo", "Um/De Um", "Nenhum/De Nenhum", "Qualquer/De Qualquer" ];
        stepInitializers[3] = () => {
            if (pronomeSelectDiv && pronomeSelectDiv.childElementCount === 0) { 
                const shuffledPronomes = [...pronomes].sort(() => 0.5 - Math.random());
                shuffledPronomes.forEach(p => {
                    const optDiv = document.createElement('div'); 
                    optDiv.textContent = p;
                    optDiv.style.padding = Math.floor(Math.random()*5 + 3) + "px"; 
                    optDiv.style.fontSize = Math.floor(Math.random()*7 + 8) + "px"; 
                    optDiv.style.fontFamily = Math.random() < 0.3 ? "Papyrus, fantasy" : (Math.random() < 0.5 ? "Comic Sans MS, cursive" : "Times New Roman, serif");
                    optDiv.style.transform = `rotate(${Math.floor(Math.random()*12 - 6)}deg) translateX(${Math.floor(Math.random()*10-5)}px)`; 
                    optDiv.style.margin = "2px";
                    optDiv.style.border = "1px dotted #ccc";
                    optDiv.style.backgroundColor = `hsl(${Math.random()*360}, 50%, 95%)`;
                    optDiv.style.cursor = 'pointer';
                    optDiv.onclick = () => { if(pronomeSelectedValueInput) pronomeSelectedValueInput.value = p; }; 
                    pronomeSelectDiv.appendChild(optDiv);
                });
            }
            if(pronomeSelectedValueInput) pronomeSelectedValueInput.value = formData[pronomeSelectedValueInput.name] || '';
        };

        // Passo 4: Gênero (Lógica mantida)
        const genderCanvas = document.getElementById('gender-canvas');
        const clearGenderCanvasBtn = document.getElementById('clear-gender-canvas');
        const genderDrawingDataInput = document.getElementById('gender-drawing-data');
        let ctxGender, drawingGender = false;
        stepInitializers[4] = () => {
            if (genderCanvas && !ctxGender) { 
                ctxGender = genderCanvas.getContext('2d');
                ctxGender.strokeStyle = "#000";
                ctxGender.lineWidth = 3;
                genderCanvas.addEventListener('mousedown', (e) => { drawingGender = true; ctxGender.beginPath(); ctxGender.moveTo(e.offsetX, e.offsetY); });
                genderCanvas.addEventListener('mousemove', (e) => { if (drawingGender) { ctxGender.lineTo(e.offsetX, e.offsetY); ctxGender.stroke(); } });
                const onMouseUpOrLeave = () => { drawingGender = false; if (genderCanvas.toDataURL && genderDrawingDataInput) {genderDrawingDataInput.value = genderCanvas.toDataURL().substring(0,50) + "..."; }};
                genderCanvas.addEventListener('mouseup', onMouseUpOrLeave);
                genderCanvas.addEventListener('mouseleave', onMouseUpOrLeave);
                if(clearGenderCanvasBtn) clearGenderCanvasBtn.addEventListener('click', () => {if(ctxGender) ctxGender.clearRect(0, 0, genderCanvas.width, genderCanvas.height); if(genderDrawingDataInput) genderDrawingDataInput.value="";});
            } else if (ctxGender) { 
                 ctxGender.clearRect(0, 0, genderCanvas.width, genderCanvas.height);
                 if(genderDrawingDataInput) genderDrawingDataInput.value = formData[genderDrawingDataInput.name] || "";
            }
        };
        stepSavers[4] = () => { if (genderDrawingDataInput && genderDrawingDataInput.value) {formData['gender-drawing-simulated'] = genderDrawingDataInput.value;} }


        // Passo 5: RG (NOVA INCONVENIÊNCIA - Modais Lentos)
        const rgInputNormal = document.getElementById('rg-input-normal');
        const iniciarConfirmacaoRgBtn = document.getElementById('iniciar-confirmacao-rg-btn');
        const rgConfirmStatusP = document.getElementById('rg-confirm-status');
        const rgConfirmadoFinalInput = document.getElementById('rg-confirmado-final');
        const rgDigitConfirmModal = document.getElementById('rg-digit-confirm-modal');
        const rgDigitConfirmTextEl = document.getElementById('rg-digit-confirm-text');
        const rgConfirmYesBtn = document.getElementById('rg-confirm-yes');
        const rgConfirmNoBtn = document.getElementById('rg-confirm-no');
        let rgDigitsToConfirm = [];
        let rgConfirmCurrentDigitIndex = 0;

        function startRgDigitConfirmation() {
            const rgValue = rgInputNormal.value.replace(/[^0-9X]/gi, '').toUpperCase(); // Limpa e padroniza
            if (rgValue.length < 5) { // Exemplo de validação mínima
                rgConfirmStatusP.textContent = "RG muito curto para confirmação.";
                rgConfirmStatusP.style.color = "red";
                return;
            }
            rgDigitsToConfirm = rgValue.split('');
            rgConfirmCurrentDigitIndex = 0;
            rgConfirmStatusP.textContent = "Iniciando confirmação...";
            rgConfirmStatusP.style.color = "blue";
            rgInputNormal.disabled = true;
            iniciarConfirmacaoRgBtn.disabled = true;
            askNextRgDigit();
        }

        function askNextRgDigit() {
            if (rgConfirmCurrentDigitIndex < rgDigitsToConfirm.length) {
                setTimeout(() => { // Atraso para o próximo modal
                    rgDigitConfirmTextEl.textContent = `O ${rgConfirmCurrentDigitIndex + 1}º dígito/caractere do seu RG é '${rgDigitsToConfirm[rgConfirmCurrentDigitIndex]}'?`;
                    rgDigitConfirmModal.style.display = 'flex';
                }, 1200); // Atraso de 1.2 segundos entre modais
            } else {
                rgConfirmStatusP.textContent = "RG confirmado com sucesso!";
                rgConfirmStatusP.style.color = "green";
                rgConfirmadoFinalInput.value = rgDigitsToConfirm.join('');
                // Não precisa mais desabilitar, já está
            }
        }
        if(iniciarConfirmacaoRgBtn) iniciarConfirmacaoRgBtn.addEventListener('click', startRgDigitConfirmation);
        if(rgConfirmYesBtn) {
            rgConfirmYesBtn.onclick = () => {
                rgDigitConfirmModal.style.display = 'none';
                rgConfirmCurrentDigitIndex++;
                askNextRgDigit();
            };
        }
        if(rgConfirmNoBtn) {
            rgConfirmNoBtn.onclick = () => {
                rgDigitConfirmModal.style.display = 'none';
                rgConfirmStatusP.textContent = "Confirmação falhou! Digite o RG novamente.";
                rgConfirmStatusP.style.color = "red";
                rgInputNormal.value = '';
                rgInputNormal.disabled = false;
                iniciarConfirmacaoRgBtn.disabled = false;
                rgDigitsToConfirm = [];
                rgConfirmCurrentDigitIndex = 0;
                rgConfirmadoFinalInput.value = '';
            };
        }
        stepInitializers[5] = () => { 
            if(rgInputNormal) {
                rgInputNormal.value = formData['rg-normal'] || ''; 
                rgInputNormal.disabled = false;
            }
            if(iniciarConfirmacaoRgBtn) iniciarConfirmacaoRgBtn.disabled = false;
            if(rgConfirmStatusP) rgConfirmStatusP.textContent = '';
            if(rgConfirmadoFinalInput) rgConfirmadoFinalInput.value = formData['rg-confirmado'] || '';
            // Se já confirmado, talvez desabilitar o botão de iniciar confirmação e input.
            if(formData['rg-confirmado'] && rgInputNormal && iniciarConfirmacaoRgBtn && rgConfirmStatusP){
                rgInputNormal.disabled = true;
                iniciarConfirmacaoRgBtn.disabled = true;
                rgConfirmStatusP.textContent = "RG já confirmado.";
                rgConfirmStatusP.style.color = "green";
            }
            rgDigitsToConfirm = [];
            rgConfirmCurrentDigitIndex = 0;
        };
        // O `rg-normal` é salvo pelo `saveStepData` genérico.
        // O `rg-confirmado-final` é salvo pela lógica de confirmação.
        
        // Passo 6: Data de Nascimento (Lógica mantida)
        const dobPrevMonthBtn = document.getElementById('dob-prev-month');
        const dobNextMonthBtn = document.getElementById('dob-next-month'); 
        const dobCurrentMonthYearSpan = document.getElementById('dob-current-month-year');
        const dobCalendarDaysDiv = document.getElementById('dob-calendar-days');
        const dataNascimentoInput = document.getElementById('data-nascimento-input');
        let dobCurrentDate; 
        function renderDOBCalendar() { /* ... (Lógica mantida da versão anterior) ... */ if(!dobCalendarDaysDiv || !dobCurrentMonthYearSpan || !dobCurrentDate) return; dobCalendarDaysDiv.innerHTML = ''; const year = dobCurrentDate.getFullYear(); const month = dobCurrentDate.getMonth(); dobCurrentMonthYearSpan.textContent = `${dobCurrentDate.toLocaleString('pt-BR', { month: 'long' })} ${year}`; const firstDayOfWeek = new Date(year, month, 1).getDay(); const daysInMonth = new Date(year, month + 1, 0).getDate(); for(let i=0; i<firstDayOfWeek; i++) { dobCalendarDaysDiv.appendChild(document.createElement('span')); } for(let day=1; day<=daysInMonth; day++) { const daySpan = document.createElement('span'); daySpan.textContent = day; daySpan.style.cursor = "pointer"; daySpan.onclick = () => { if(dataNascimentoInput) dataNascimentoInput.value = `${String(day).padStart(2,'0')}/${String(month+1).padStart(2,'0')}/${year}`; }; dobCalendarDaysDiv.appendChild(daySpan); } const todayForCalendarLimit = new Date(2025, 4, 1); if(dobNextMonthBtn) dobNextMonthBtn.disabled = (dobCurrentDate.getFullYear() === todayForCalendarLimit.getFullYear() && dobCurrentDate.getMonth() === todayForCalendarLimit.getMonth()); }
        if(dobPrevMonthBtn) dobPrevMonthBtn.addEventListener('click', () => { if(dobCurrentDate) {dobCurrentDate.setMonth(dobCurrentDate.getMonth() - 1); renderDOBCalendar();} });
        if(dobNextMonthBtn) dobNextMonthBtn.addEventListener('click', () => { const todayForCalendarLimit = new Date(2025, 4, 1); if (dobCurrentDate && dobCurrentDate < todayForCalendarLimit) { dobCurrentDate.setMonth(dobCurrentDate.getMonth() + 1); renderDOBCalendar(); } });
        stepInitializers[6] = () => { const existingDob = formData['data-nascimento']; if (existingDob) { const parts = existingDob.split('/'); if (parts.length === 3) { dobCurrentDate = new Date(parseInt(parts[2]), parseInt(parts[1]) - 1, parseInt(parts[0])); if (isNaN(dobCurrentDate.getTime())) dobCurrentDate = new Date(2025, 4, 25); } else { dobCurrentDate = new Date(2025, 4, 25); } } else { dobCurrentDate = new Date(2025, 4, 25); } if(dataNascimentoInput) dataNascimentoInput.value = existingDob || ''; renderDOBCalendar(); };

        // Passo 7: Idade (Lógica mantida)
        const ageIncrementBtn = document.getElementById('age-increment-btn');
        const ageDisplaySpan = document.getElementById('age-display');
        const ageResetBtn = document.getElementById('age-reset-btn');
        const idadeHiddenInput = document.getElementById('idade-input');
        let currentAgeVal = 0; 
        stepInitializers[7] = () => { currentAgeVal = parseInt(formData[idadeHiddenInput.name]) || 0; if(ageDisplaySpan) ageDisplaySpan.textContent = currentAgeVal; if(idadeHiddenInput) idadeHiddenInput.value = currentAgeVal; };
        if(ageIncrementBtn) ageIncrementBtn.addEventListener('click', () => { currentAgeVal++; if(ageDisplaySpan) ageDisplaySpan.textContent = currentAgeVal; if(idadeHiddenInput) idadeHiddenInput.value = currentAgeVal; });
        if(ageResetBtn) ageResetBtn.addEventListener('click', () => { currentAgeVal = 0; if(ageDisplaySpan) ageDisplaySpan.textContent = currentAgeVal; if(idadeHiddenInput) idadeHiddenInput.value = currentAgeVal; });

        // Passo 8: E-mail (Lógica mantida)
        const emailCharSelectsDiv = document.getElementById('email-char-selects');
        const addEmailCharBtn = document.getElementById('add-email-char-select');
        const removeEmailCharBtn = document.getElementById('remove-email-char-select');
        const emailPreviewInput = document.getElementById('email-preview');
        const emailCharsList = "abcdefghijklmnopqrstuvwxyz0123456789.@-_".split(''); 
        let emailSelectCount = 5; 
        function renderEmailSelects() { /* ... (Lógica mantida da versão anterior) ... */  if(!emailCharSelectsDiv) return; emailCharSelectsDiv.innerHTML = ''; const currentEmailVal = formData['email-final'] || ''; for(let i=0; i<emailSelectCount; i++) { const select = document.createElement('select'); select.name = 'email_char_' + i; emailCharsList.forEach(char => { const option = document.createElement('option'); option.value = char; option.textContent = char; if (currentEmailVal[i] === char) option.selected = true; select.appendChild(option); }); select.addEventListener('change', updateEmailPreview); emailCharSelectsDiv.appendChild(select); } updateEmailPreview(); }
        function updateEmailPreview() { /* ... (Lógica mantida da versão anterior) ... */ let currentEmail = ""; if(emailCharSelectsDiv) emailCharSelectsDiv.querySelectorAll('select').forEach(sel => currentEmail += sel.value); if(emailPreviewInput) emailPreviewInput.value = currentEmail;  }
        if(addEmailCharBtn) addEmailCharBtn.addEventListener('click', () => { emailSelectCount = Math.min(40, emailSelectCount + 1); renderEmailSelects(); }); 
        if(removeEmailCharBtn) removeEmailCharBtn.addEventListener('click', () => { if(emailSelectCount>1) { emailSelectCount--; renderEmailSelects(); } });
        stepInitializers[8] = () => { const existingEmail = formData['email-final'] || ''; emailSelectCount = existingEmail ? Math.max(5, existingEmail.length) : 5; renderEmailSelects(); };
        stepSavers[8] = () => { if(emailPreviewInput) formData['email-final'] = emailPreviewInput.value; }

        // Passo 9: Telefone (Lógica mantida)
        const telefoneInput = document.getElementById('telefone-input');
        const telefoneKeypadDiv = document.getElementById('telefone-keypad');
        let telDigitsList = "0123456789".split(''); 
        function shuffleTelDigits() { /* ... (Lógica mantida da versão anterior) ... */ for (let i = telDigitsList.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [telDigitsList[i], telDigitsList[j]] = [telDigitsList[j], telDigitsList[i]]; } }
        function renderTelefoneKeypad() { /* ... (Lógica mantida da versão anterior) ... */ if(!telefoneKeypadDiv) return; shuffleTelDigits(); telefoneKeypadDiv.innerHTML = ''; const displayDigitsAndBackspace = [...telDigitsList.slice(0,9), '⌫', telDigitsList[9], ' ']; displayDigitsAndBackspace.forEach(digit => { const btn = document.createElement('button'); btn.textContent = digit; btn.type = "button"; if (digit === " ") { btn.disabled = true; btn.style.opacity=0;} btn.onclick = () => { if (telefoneInput) { if (digit === '⌫') { telefoneInput.value = telefoneInput.value.slice(0, -1); } else if (digit !== " " && telefoneInput.value.length < 15) { telefoneInput.value += digit; } } if (digit !== " ") renderTelefoneKeypad(); }; telefoneKeypadDiv.appendChild(btn); }); }
        stepInitializers[9] = () => { if(telefoneInput) telefoneInput.value = formData[telefoneInput.name] || ''; renderTelefoneKeypad(); }

        // Passo 10: Cidade/Estado (Lógica mantida)
        const cidadeInput = document.getElementById('cidade-input');
        const estadoSelect = document.getElementById('estado-select');
        const estadosBrasileiros = ["Acre", "Alagoas", "Amapá", "Amazonas", "Bahia", "Ceará", "Distrito Federal", "Espírito Santo", "Goiás", "Maranhão", "Mato Grosso", "Mato Grosso do Sul", "Minas Gerais", "Pará", "Paraíba", "Paraná", "Pernambuco", "Piauí", "Rio de Janeiro", "Rio Grande do Norte", "Rio Grande do Sul", "Rondônia", "Roraima", "Santa Catarina", "São Paulo", "Sergipe", "Tocantins"];
        stepInitializers[10] = () => { if(cidadeInput) cidadeInput.value = formData['cidade'] || ''; if (estadoSelect && estadoSelect.options.length <= 1) { const shuffledEstados = [...estadosBrasileiros].sort(() => Math.random() - 0.5); const placeholderOpt = document.createElement('option'); placeholderOpt.value = ""; placeholderOpt.textContent = "Selecione..."; placeholderOpt.disabled = true; estadoSelect.appendChild(placeholderOpt); shuffledEstados.forEach(est => { const option = document.createElement('option'); option.value = est; option.textContent = est; estadoSelect.appendChild(option); }); } if(estadoSelect) estadoSelect.value = formData['estado'] || ""; };
        if(cidadeInput) { cidadeInput.addEventListener('input', (e) => { const currentVal = cidadeInput.value; if (e.inputType === "insertText" || e.inputType === "insertCompositionText") { setTimeout(() => { const newTextLength = cidadeInput.value.length; const randomJumpPos = Math.floor(Math.random() * (newTextLength + 1)); cidadeInput.setSelectionRange(randomJumpPos, randomJumpPos); }, 0); } }); }

        // Passo 11: Seinen/Entidade (Lógica mantida)
        const seinenEntidadeInput = document.getElementById('seinen-entidade');
        const seinenQuizModal = document.getElementById('seinen-quiz-modal');
        const seinenQuizQuestionEl = document.getElementById('seinen-quiz-question');
        const seinenQuizOptionsEl = document.getElementById('seinen-quiz-options');
        const seinenQuizFeedbackEl = document.getElementById('seinen-quiz-feedback');
        let seinenCharsTyped = 0; let seinenPreviousLength = 0; let seinenValueBeforeQuiz = ""; 
        const seinenQuizzes = [ { q: "Qual destes animes NÃO é do Studio Ghibli?", o: ["Meu Amigo Totoro", "A Viagem de Chihiro", "Your Name"], a: "Your Name"}, { q: "O que é 'undokai'?", o: ["Festival de dança", "Gincana esportiva escolar", "Cerimônia do chá"], a: "Gincana esportiva escolar"}, { q: "Qual o nome do famoso bairro japonês em São Paulo?", o: ["Chinatown", "Liberdade", "Copacabana"], a: "Liberdade"} ];
        if(seinenEntidadeInput && seinenQuizModal) { seinenEntidadeInput.addEventListener('input', () => { /* ... (Lógica mantida da versão anterior) ... */ if (seinenQuizModal.style.display === 'block') return; const currentLength = seinenEntidadeInput.value.length; if (currentLength > seinenPreviousLength) { seinenCharsTyped += (currentLength - seinenPreviousLength); } else if (currentLength < seinenPreviousLength) { seinenCharsTyped = Math.max(0, seinenCharsTyped - (seinenPreviousLength - currentLength)); } seinenPreviousLength = currentLength; if (seinenCharsTyped >= 3) { seinenValueBeforeQuiz = seinenEntidadeInput.value; const charsThatTriggered = seinenCharsTyped; seinenCharsTyped = 0; const currentQuiz = seinenQuizzes[Math.floor(Math.random() * seinenQuizzes.length)]; seinenQuizQuestionEl.textContent = currentQuiz.q; seinenQuizOptionsEl.innerHTML = ''; currentQuiz.o.forEach(optText => { const btn = document.createElement('button'); btn.textContent = optText; btn.type = "button"; btn.onclick = () => { if (optText === currentQuiz.a) { seinenQuizFeedbackEl.textContent = "Correto! Continue."; seinenQuizFeedbackEl.style.color = "green"; } else { seinenQuizFeedbackEl.textContent = "Errado! Os últimos caracteres digitados foram removidos."; seinenQuizFeedbackEl.style.color = "red"; seinenEntidadeInput.value = seinenValueBeforeQuiz.slice(0, seinenValueBeforeQuiz.length - charsThatTriggered); seinenPreviousLength = seinenEntidadeInput.value.length; } setTimeout(() => { seinenQuizModal.style.display = 'none'; seinenQuizFeedbackEl.textContent = ""; seinenEntidadeInput.focus(); }, 1800); }; seinenQuizOptionsEl.appendChild(btn); }); seinenQuizModal.style.display = 'block'; } }); }
        stepInitializers[11] = () => { if(seinenEntidadeInput) seinenEntidadeInput.value = formData[seinenEntidadeInput.name] || ''; seinenCharsTyped = 0; seinenPreviousLength = seinenEntidadeInput ? seinenEntidadeInput.value.length : 0; if(seinenQuizModal) seinenQuizModal.style.display = 'none'; };

        // Passo 12: REVI Participação (Lógica mantida)
        const reviSimMainRadio = document.getElementById('revi-sim-main');
        const reviNaoRadio = document.getElementById('revi-nao');
        const reviConfirmCheckboxesDiv = document.getElementById('revi-confirm-checkboxes');
        const reviConfirm1 = document.getElementById('revi-confirm1');
        const reviConfirm2 = document.getElementById('revi-confirm2');
        const reviConfirm3 = document.getElementById('revi-confirm3');
        function toggleReviConfirms() { /* ... (Lógica mantida da versão anterior) ... */  if (!reviSimMainRadio || !reviConfirmCheckboxesDiv || !reviConfirm1 || !reviConfirm2 || !reviConfirm3) return; if (reviSimMainRadio.checked) { reviConfirmCheckboxesDiv.style.display = 'block'; } else { reviConfirmCheckboxesDiv.style.display = 'none'; reviConfirm1.checked = false; reviConfirm2.checked = false; reviConfirm3.checked = false; reviConfirm2.disabled = true; reviConfirm3.disabled = true;} }
        if(reviSimMainRadio) reviSimMainRadio.addEventListener('change', toggleReviConfirms);
        if(reviNaoRadio) reviNaoRadio.addEventListener('change', toggleReviConfirms);
        if(reviConfirm1) reviConfirm1.addEventListener('change', () => { if(reviConfirm2) {reviConfirm2.disabled = !reviConfirm1.checked; if(!reviConfirm1.checked) {reviConfirm2.checked=false; if(reviConfirm3) {reviConfirm3.disabled=true; reviConfirm3.checked=false;}}} });
        if(reviConfirm2) reviConfirm2.addEventListener('change', () => { if(reviConfirm3) {reviConfirm3.disabled = !reviConfirm2.checked; if(!reviConfirm2.checked) reviConfirm3.checked=false;} });
        stepInitializers[12] = () => { /* ... (Lógica mantida da versão anterior) ... */ const participou = formData['revi-participou']; if (reviSimMainRadio && reviNaoRadio) { reviSimMainRadio.checked = participou === 'sim'; reviNaoRadio.checked = participou === 'nao' || !participou; } if(participou === 'sim' && formData['revi-confirmacoes']) { const confirmacoes = formData['revi-confirmacoes']; if(reviConfirm1) reviConfirm1.checked = confirmacoes.c1 || false; if(reviConfirm2) reviConfirm2.checked = confirmacoes.c2 || false; if(reviConfirm3) reviConfirm3.checked = confirmacoes.c3 || false; } toggleReviConfirms();  };
        stepSavers[12] = () => { /* ... (Lógica mantida da versão anterior) ... */ formData['revi-participou'] = reviSimMainRadio.checked ? 'sim' : 'nao'; if(reviSimMainRadio.checked && reviConfirm1 && reviConfirm2 && reviConfirm3) { formData['revi-confirmacoes'] = {c1: reviConfirm1.checked, c2: reviConfirm2.checked, c3: reviConfirm3.checked}; } else { delete formData['revi-confirmacoes']; } }

        // Passo 13: Restrição Alimentar (Lógica mantida)
        const restricaoSelect = document.getElementById('restricao-alimentar-select');
        const restricaoDetalhesDiv = document.getElementById('restricao-alimentar-detalhes');
        const restricaoQualInput = document.getElementById('restricao-alimentar-qual');
        if(restricaoSelect && restricaoDetalhesDiv && restricaoQualInput){ restricaoSelect.addEventListener('change', () => { restricaoDetalhesDiv.style.display = restricaoSelect.value === 'sim' ? 'block' : 'none'; if(restricaoSelect.value === 'nao') {restricaoQualInput.value = ''; restricaoQualInput.style.fontSize = '16px';} }); restricaoQualInput.addEventListener('input', () => { const len = restricaoQualInput.value.length; const newMaxLen = 30; const baseFontSize = 16; const minFontSize = 3; let newSize = baseFontSize - (len / newMaxLen) * (baseFontSize - minFontSize); newSize = Math.max(minFontSize, newSize); restricaoQualInput.style.fontSize = `${newSize}px`; }); }
        stepInitializers[13] = () => { /* ... (Lógica mantida da versão anterior) ... */ if(restricaoSelect) restricaoSelect.value = formData['restricao-alimentar-opcao'] || 'nao'; if(restricaoDetalhesDiv && restricaoSelect) restricaoDetalhesDiv.style.display = restricaoSelect.value === 'sim' ? 'block' : 'none'; if(restricaoQualInput) { restricaoQualInput.value = formData['restricao-alimentar-qual'] || ''; const event = new Event('input', { bubbles: true, cancelable: true, }); restricaoQualInput.dispatchEvent(event); } }

        // Passo 14: Alergia (Lógica mantida)
        const alergiaSelect = document.getElementById('alergia-select');
        const alergiaDetalhesDiv = document.getElementById('alergia-detalhes');
        const alergiaQualInputDisplay = document.getElementById('alergia-qual'); 
        let alergiaRealValue = ""; 
        if(alergiaSelect && alergiaDetalhesDiv && alergiaQualInputDisplay) { alergiaSelect.addEventListener('change', () => { alergiaDetalhesDiv.style.display = alergiaSelect.value === 'sim' ? 'block' : 'none'; if(alergiaSelect.value === 'nao') { alergiaQualInputDisplay.value = ''; alergiaRealValue = ''; } }); alergiaQualInputDisplay.addEventListener('input', (e) => { const currentDisplayValue = alergiaQualInputDisplay.value; let typedChar = e.data; if (e.inputType === "insertText" && typedChar) { alergiaRealValue += typedChar; } alergiaQualInputDisplay.value = "*".repeat(alergiaRealValue.length); }); alergiaQualInputDisplay.addEventListener('keydown', (e) => { if (e.key === 'Backspace') { if (alergiaRealValue.length > 0) { alergiaRealValue = alergiaRealValue.slice(0, -1); } setTimeout(() => { alergiaQualInputDisplay.value = "*".repeat(alergiaRealValue.length); }, 0); } }); }
        stepInitializers[14] = () => { /* ... (Lógica mantida da versão anterior) ... */ if(alergiaSelect) alergiaSelect.value = formData['alergia-opcao'] || 'nao'; if(alergiaDetalhesDiv && alergiaSelect) alergiaDetalhesDiv.style.display = alergiaSelect.value === 'sim' ? 'block' : 'none'; alergiaRealValue = formData['alergia-qual-real'] || ''; if(alergiaQualInputDisplay) alergiaQualInputDisplay.value = "*".repeat(alergiaRealValue.length); };
        stepSavers[14] = () => { if(alergiaSelect && alergiaSelect.value === 'sim') formData['alergia-qual-real'] = alergiaRealValue; }

        // Passo 15: Remédio Contínuo (Lógica mantida)
        const remedioSelect = document.getElementById('remedio-continuo-select');
        const remedioDetalhesDiv = document.getElementById('remedio-continuo-detalhes');
        const remedioQualInput = document.getElementById('remedio-continuo-qual');
        const remedioMouseStatusP = document.getElementById('remedio-mouse-status');
        let mouseMovingInField = false; let mouseMoveTimeoutRemedio; 
        if(remedioSelect && remedioDetalhesDiv && remedioQualInput && remedioMouseStatusP){ remedioSelect.addEventListener('change', () => { remedioDetalhesDiv.style.display = remedioSelect.value === 'sim' ? 'block' : 'none'; if(remedioSelect.value === 'nao') remedioQualInput.value = '';}); remedioQualInput.addEventListener('focus', () => { remedioMouseStatusP.textContent = "Mova o mouse dentro do campo para digitar!"; remedioQualInput.readOnly = true; }); remedioQualInput.addEventListener('mousemove', () => { mouseMovingInField = true; remedioQualInput.readOnly = false; remedioMouseStatusP.textContent = "Digitando..."; remedioMouseStatusP.style.color = "green"; clearTimeout(mouseMoveTimeoutRemedio); mouseMoveTimeoutRemedio = setTimeout(() => { mouseMovingInField = false; remedioQualInput.readOnly = true; remedioMouseStatusP.textContent = "Mouse parado! Mova para continuar."; remedioMouseStatusP.style.color = "red"; }, 700); }); remedioQualInput.addEventListener('mouseleave', () => { mouseMovingInField = false; remedioQualInput.readOnly = true; remedioMouseStatusP.textContent = "Mouse fora do campo! Volte e mova."; remedioMouseStatusP.style.color = "red"; clearTimeout(mouseMoveTimeoutRemedio);}); }
        stepInitializers[15] = () => { /* ... (Lógica mantida da versão anterior) ... */ if(remedioSelect) remedioSelect.value = formData['remedio-continuo-opcao'] || 'nao'; if(remedioDetalhesDiv && remedioSelect) remedioDetalhesDiv.style.display = remedioSelect.value === 'sim' ? 'block' : 'none'; if(remedioQualInput) remedioQualInput.value = formData['remedio-continuo-qual'] || ''; if(remedioMouseStatusP) remedioMouseStatusP.textContent = "";  };

        // Passo 16: Tamanho da Camiseta (Lógica mantida)
        const camisetaShape = document.getElementById('camiseta-shape');
        const camisetaSliders = document.querySelectorAll('#camiseta-sliders input[type="range"]');
        const camisetaConfigInput = document.getElementById('camiseta-config-input');
        function updateCamisetaPreview() { /* ... (Lógica mantida da versão anterior) ... */ if(!camisetaShape || !camisetaConfigInput) return; const config = {}; let displayText = ""; camisetaSliders.forEach(slider => { const id = slider.id.replace('slider-', ''); config[id] = slider.value; displayText += `${id.substring(0,1).toUpperCase()}:${slider.value} `; }); camisetaShape.style.width = `${config.peito || 50}%`; camisetaShape.style.height = `${config.comprimento || 60}%`; camisetaShape.style.borderRadius = `${100 - (config.gola || 20)}px ${100 - (config.gola || 20)}px 0 0`; camisetaShape.textContent = displayText.trim(); camisetaConfigInput.value = JSON.stringify(config); }
        camisetaSliders.forEach(slider => slider.addEventListener('input', updateCamisetaPreview));
        stepInitializers[16] = () => { /* ... (Lógica mantida da versão anterior) ... */ const savedConfigJson = formData['camiseta-config']; if (savedConfigJson) { try { const config = JSON.parse(savedConfigJson); camisetaSliders.forEach(slider => { const id = slider.id.replace('slider-', ''); if (config[id]) slider.value = config[id]; }); } catch(e) { console.error("Erro ao carregar config da camiseta", e); } } updateCamisetaPreview(); };

        // Passo 17: Ano no Grupo (Lógica mantida)
        const anoGrupoSlider = document.getElementById('ano-grupo-slider');
        const anoGrupoSliderValueSpan = document.getElementById('ano-grupo-slider-value');
        if(anoGrupoSlider && anoGrupoSliderValueSpan) { anoGrupoSlider.addEventListener('input', () => { setTimeout(() => { anoGrupoSliderValueSpan.textContent = anoGrupoSlider.value; }, Math.random()*300 + 50); }); }
        stepInitializers[17] = () => { /* ... (Lógica mantida da versão anterior) ... */ if(anoGrupoSlider) anoGrupoSlider.value = formData[anoGrupoSlider.name] || 2000; if(anoGrupoSliderValueSpan && anoGrupoSlider) anoGrupoSliderValueSpan.textContent = anoGrupoSlider.value;  }; 

        // Passo 18: Cargo Entidade 1 (Lógica mantida)
        const cargo1Input = document.getElementById('cargo-entidade1-input');
        const cargo1AddBtn = document.getElementById('cargo-entidade1-add-word');
        const cargo1WordArea = document.getElementById('cargo-entidade1-word-area');
        const cargo1FinalInput = document.getElementById('cargo-entidade1-final');
        function updateCargo1Final() { /* ... (Lógica mantida da versão anterior) ... */ let fullText = ""; if(cargo1WordArea) cargo1WordArea.querySelectorAll('span').forEach(s => fullText += s.textContent + " "); if(cargo1FinalInput) cargo1FinalInput.value = fullText.trim();  }
        if(cargo1AddBtn && cargo1Input && cargo1WordArea) { cargo1AddBtn.addEventListener('click', () => { const word = cargo1Input.value.trim(); if (word) { const span = document.createElement('span'); span.textContent = word; span.onclick = () => { span.classList.toggle('fixed'); span.style.animation = span.classList.contains('fixed') ? 'none' : 'fadeOut 3s forwards'; if(span.classList.contains('fixed')) span.style.opacity = 1; updateCargo1Final(); }; cargo1WordArea.appendChild(span); cargo1Input.value = ''; updateCargo1Final(); } }); }
        stepInitializers[18] = () => { /* ... (Lógica mantida da versão anterior) ... */ if(cargo1WordArea) cargo1WordArea.innerHTML = ''; if(cargo1Input) cargo1Input.value = ''; if(cargo1FinalInput) cargo1FinalInput.value = formData[cargo1FinalInput.name] || ''; if(formData[cargo1FinalInput.name] && cargo1WordArea) { const words = formData[cargo1FinalInput.name].split(' '); words.forEach(w => { if(w.trim()){ const span = document.createElement('span'); span.textContent = w; span.classList.add('fixed'); span.style.opacity = 1; cargo1WordArea.appendChild(span); } }); } };

        // Passo 19: Termos e Condições (Lógica mantida)
        const termosPalavraCountInput = document.getElementById('termos-palavra-count');
        const termosConcordoCheckbox = document.getElementById('termos-concordo');
        const termosFeedbackP = document.getElementById('termos-feedback');
        const CORRETA_CONTAGEM_RESPONSABILIDADE = 7; 
        if(termosPalavraCountInput && termosConcordoCheckbox && termosFeedbackP){ termosPalavraCountInput.addEventListener('input', () => { const count = parseInt(termosPalavraCountInput.value); if (count === CORRETA_CONTAGEM_RESPONSABILIDADE) { termosConcordoCheckbox.disabled = false; termosFeedbackP.textContent = "Contagem correta! Pode prosseguir."; termosFeedbackP.style.color = "green"; } else { termosConcordoCheckbox.disabled = true; termosConcordoCheckbox.checked = false; termosFeedbackP.textContent = "Número incorreto. A leitura atenta dos termos é fundamental."; termosFeedbackP.style.color = "red"; }}); }
        stepInitializers[19] = () => { /* ... (Lógica mantida da versão anterior) ... */ if(termosPalavraCountInput) termosPalavraCountInput.value = formData[termosPalavraCountInput.name] || ''; if(termosPalavraCountInput) { const event = new Event('input', { bubbles: true, cancelable: true, }); termosPalavraCountInput.dispatchEvent(event); } if(termosConcordoCheckbox) termosConcordoCheckbox.checked = (formData[termosConcordoCheckbox.name] === 'concordo' || formData[termosConcordoCheckbox.name] === true) && !termosConcordoCheckbox.disabled; };

        // Passo 20: Contato de Emergência (Lógica mantida)
        const ceNomeInput = document.getElementById('contato-emergencia-nome');
        const ceNomeKeyboardDiv = document.getElementById('contato-emergencia-nome-keyboard');
        const ceNomeBackspaceBtn = document.getElementById('contato-emergencia-nome-backspace');
        const ceKeyboardCharsList = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(''); 
        function renderCeNomeKeyboard() { /* ... (Lógica mantida da versão anterior) ... */ if(!ceNomeKeyboardDiv) return; ceNomeKeyboardDiv.innerHTML = ''; const shuffled = [...ceKeyboardCharsList].sort(() => 0.5 - Math.random()); shuffled.slice(0, 30).forEach(char => { const btn = document.createElement('button'); btn.textContent = char; btn.type = "button"; btn.onclick = () => { if(ceNomeInput) ceNomeInput.value += char; renderCeNomeKeyboard(); }; ceNomeKeyboardDiv.appendChild(btn); });}
        if(ceNomeBackspaceBtn && ceNomeInput) ceNomeBackspaceBtn.onclick = () => { ceNomeInput.value = ceNomeInput.value.slice(0,-1); }
        const ceTelSlidersContainer = document.getElementById('contato-emergencia-telefone-sliders');
        const ceTelPreviewInput = document.getElementById('contato-emergencia-telefone-preview');
        let ceTelSliders, ceTelSliderVals; 
        function updateCeTelefonePreview() { /* ... (Lógica mantida da versão anterior) ... */ if(!ceTelSliders || !ceTelPreviewInput) return; let num = ""; ceTelSliders.forEach((slider, index) => { if(ceTelSliderVals[index]) ceTelSliderVals[index].textContent = slider.value; num += slider.value; }); ceTelPreviewInput.value = `(${num.substring(0,2)}) ${num.substring(2,7)}-${num.substring(7,11)}`;}
        stepInitializers[20] = () => { /* ... (Lógica mantida da versão anterior, com inicialização de ceTelSliders) ... */ if(ceNomeInput) ceNomeInput.value = formData[ceNomeInput.name] || ''; renderCeNomeKeyboard(); if(ceTelSlidersContainer){ ceTelSliders = ceTelSlidersContainer.querySelectorAll('input[type="range"]'); ceTelSliderVals = ceTelSlidersContainer.querySelectorAll('.slider-val'); ceTelSliders.forEach(slider => {slider.removeEventListener('input', updateCeTelefonePreview); slider.addEventListener('input', updateCeTelefonePreview);});} const telVal = formData[ceTelPreviewInput.name] ? (formData[ceTelPreviewInput.name].replace(/\D/g, '') || "00000000000") : "00000000000"; if(ceTelSliders) ceTelSliders.forEach((slider, index) => { slider.value = telVal[index] || '0'; }); updateCeTelefonePreview();  }
        
        // Passo 21: Dificuldades Seinekai (NOVA INCONVENIÊNCIA)
        const dificuldadesInputEl = document.getElementById('dificuldades-seinekai-input'); // Renomeado
        const dificuldadesEcoBox = document.getElementById('dificuldades-eco-box');
        const dificuldadesFinalInput = document.getElementById('dificuldades-seinekai-final'); // Input hidden para o valor final
        const finalizarDesabafoBtn = document.getElementById('finalizar-desabafo-btn');
        let dificuldadesBuffer = "";
        let dificuldadesTimeoutId = null;
        const ghostCharsPool = "░▒▓█▇▆▅▃▂ "; // Caracteres fantasma

        if (dificuldadesInputEl && dificuldadesEcoBox && dificuldadesFinalInput && finalizarDesabafoBtn) {
            dificuldadesInputEl.addEventListener('input', (e) => {
                const char = e.data; // Último caractere digitado
                if (e.inputType === "insertText" && char) {
                    dificuldadesBuffer += char;
                    const tempGhost = ghostCharsPool[Math.floor(Math.random() * ghostCharsPool.length)];
                    const spanGhost = document.createElement('span');
                    spanGhost.className = 'distorted-char-temp'; // Pode usar para estilizar o "fantasma"
                    spanGhost.textContent = tempGhost;
                    dificuldadesEcoBox.appendChild(spanGhost);

                    setTimeout(() => {
                        if (dificuldadesEcoBox.contains(spanGhost)) { // Verifica se o fantasma ainda está lá
                            dificuldadesEcoBox.removeChild(spanGhost);
                        }
                        // Adiciona o caractere real ao eco box (já está no buffer)
                        // Para mostrar o eco caractere por caractere real:
                        // dificuldadesEcoBox.textContent = dificuldadesBuffer; // Ou uma lógica mais elaborada de append
                        // A lógica abaixo vai mostrar o buffer completo no final.
                        // Para o eco distorcido, vamos deixar o buffer acumular e mostrar tudo ao finalizar.
                        // A ideia do eco distorcido caractere a caractere é mais complexa com o buffer.
                        // Simplificando: mostra o buffer no eco box com atraso.
                    }, 2000 + Math.random() * 1000); // Atraso de 2-3s por caractere
                } else if (e.inputType === "deleteContentBackward") {
                    dificuldadesBuffer = dificuldadesBuffer.slice(0, -1);
                }
                 // Atualiza o eco box com o buffer (pode ser frustrante ver tudo de uma vez depois do atraso)
                 if (dificuldadesTimeoutId) clearTimeout(dificuldadesTimeoutId);
                 dificuldadesTimeoutId = setTimeout(() => {
                    dificuldadesEcoBox.innerHTML = ''; // Limpa
                    dificuldadesBuffer.split('').forEach(bufferedChar => {
                        const charSpan = document.createElement('span');
                        charSpan.className = 'distorted-char-temp'; // Reutiliza para dar um "efeito" ao aparecer
                        charSpan.textContent = bufferedChar;
                        dificuldadesEcoBox.appendChild(charSpan);
                        setTimeout(() => { charSpan.className = '';}, 150); // Remove distorção rápida
                    });
                 }, 500); // Mostra o buffer no eco após pequena pausa na digitação
            });

            finalizarDesabafoBtn.addEventListener('click', () => {
                dificuldadesFinalInput.value = dificuldadesBuffer; // Transfere o buffer para o input final
                dificuldadesEcoBox.innerHTML = `<em>Texto transferido para o sistema (esperamos).</em>`;
                dificuldadesInputEl.disabled = true; // Opcional: desabilitar após finalizar
                finalizarDesabafoBtn.disabled = true;
                alert("Seu desabafo foi... processado. Obrigado.");
            });
        }
        stepInitializers[21] = () => { 
            if(dificuldadesInputEl) {
                dificuldadesInputEl.value = formData['dificuldades-seinekai-input-buffer'] || ''; // Se quiser salvar o buffer do input
                dificuldadesInputEl.disabled = false;
            }
            if(dificuldadesEcoBox) dificuldadesEcoBox.innerHTML = '';
            if(dificuldadesFinalInput) dificuldadesFinalInput.value = formData['dificuldades-seinekai'] || ''; // Valor final
            dificuldadesBuffer = formData['dificuldades-seinekai-input-buffer'] || ''; // Restaurar buffer
             if (dificuldadesTimeoutId) clearTimeout(dificuldadesTimeoutId);
            if(finalizarDesabafoBtn) finalizarDesabafoBtn.disabled = false;
            // Se já finalizado antes, manter estado
            if(formData['dificuldades-seinekai'] && dificuldadesInputEl && finalizarDesabafoBtn && dificuldadesEcoBox){
                dificuldadesInputEl.disabled = true;
                finalizarDesabafoBtn.disabled = true;
                dificuldadesEcoBox.innerHTML = `<em>Desabafo anteriormente processado.</em>`
            }
        };
        stepSavers[21] = () => { 
             // O valor de 'dificuldades-seinekai' (hidden input) já é pego pelo saveStepData genérico
             // Mas podemos salvar o buffer do input se o usuário não clicou em "finalizar"
             if(dificuldadesInputEl && !dificuldadesInputEl.disabled) formData['dificuldades-seinekai-input-buffer'] = dificuldadesBuffer;
        }

        // Links da landing page
        const orgLink = document.getElementById('org-link');
        const socialLink = document.getElementById('social-link');
        if(orgLink) orgLink.onclick = (e) => {e.preventDefault(); alert("Link de Instagram da @comissaodejovensbunkyo (simulado!)");}
        if(socialLink) socialLink.onclick = (e) => {e.preventDefault(); alert("Link de Instagram da @comissaodejovensbunkyo (simulado!)");}
    </script>
</body>
</html>